<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil do Usuário</title>
    <link rel="stylesheet" href="/paginas/perfil/perfil.css">
    <script src="/paginas/perfil/img.js"></script>
</head>
<body>
    <div class="profile-container">
        <div class="profile-header">
            <div style="font-family: 'Comic Sans MS', cursive, sans-serif;">
                <h1>Bem-vindo ao seu perfil!</h1>
                <hr>
            </div>
            <img id="profile-picture" src="" alt="Foto de Perfil">
            <h1 id="user-name"></h1>
            <p id="user-email"></p>
        </div>
        <ul class="profile-details">
            <li><strong>Preferências de Leitura:</strong> <span id="user-preferences"></span></li>
        </ul>
    </div>

    <!-- Script para carregar informações do perfil do usuário -->
    <script>
      async function loadUserProfile() {
        const userId = sessionStorage.getItem("usuarioId");
        
        if (!userId) {
          alert("Usuário não está logado");
          window.location.href = "/login";
          return;
        }
        
        try {
          const response = await fetch(`http://localhost:3000/usuarios/perfil/${userId}`);
          const user = await response.json();

          if (response.ok) {
            document.getElementById("user-name").textContent = user.nome;
            document.getElementById("user-email").textContent = user.email;
            document.getElementById("profile-picture").src = user.foto_perfil || getRandomImage();
            document.getElementById("user-preferences").textContent = user.preferencias_leitura || "Não especificado";
          } else {
            alert(user.message || "Erro ao carregar perfil do usuário");
          }
        } catch (error) {
          console.error("Erro ao carregar perfil do usuário", error);
          alert("Erro ao conectar com o servidor");
        }
      }

      // Chama a função para carregar as informações do usuário
      window.onload = loadUserProfile;
    </script>
</body>
</html>
